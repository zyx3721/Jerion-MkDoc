
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="记录相关知识，沉淀生活，记录点滴。">
      
      
        <meta name="author" content="Jerion">
      
      
        <link rel="canonical" href="https://jerion.cn/k8s/%E5%9F%BA%E4%BA%8EContainerd%E7%9A%84K8S%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/">
      
      
        <link rel="prev" href="../k8s%E5%88%9B%E5%BB%BA%E5%AE%89%E8%A3%85dashboard/">
      
      
        <link rel="next" href="../../git/Git/Git%20Extensions%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS 订阅" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="已更新内容的 RSS 订阅" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.33">
    
    
      
        <title>1 K8S集群安装 - Jerion's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Microsoft+Yahei:300,300i,400,400i,700,700i%7CConsolas,Courier,courier+new,stkaiti,kaiti,simkai,monospace:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Microsoft Yahei";--md-code-font:"Consolas,Courier,courier new,stkaiti,kaiti,simkai,monospace"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  <script async src="https://umami.weiyan.cc/script.js" data-website-id="b713abc7-f5eb-4683-a132-9fda53e29198"></script>
<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id:"3JIbgFniDcGIaNP7",ck:"3JIbgFniDcGIaNP7",autoTrack:true})</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
   <meta name="baidu-site-verification" content="codeva-hJH2gPjZkn" />

   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-k8s集群安装" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jerion&#39;s Blog" class="md-header__button md-logo" aria-label="Jerion's Blog" data-md-component="logo">
      
  <img src="../../assets/octocat.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jerion's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1 K8S集群安装
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="deep-orange"  aria-label="切换到暗色模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换到暗色模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="grey" data-md-color-accent="deep-orange"  aria-label="切换到亮色模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换到亮色模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/zyx3721/Jerion-MkDoc" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Jerion-MkDoc
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux/Ansible/Ansible%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E4%BD%BF%E7%94%A8/" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../shell/" class="md-tabs__link">
          
  
    
  
  Shell

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../vmware/Esxi6.7%E5%AE%89%E8%A3%85MacOS%2010.15.6/" class="md-tabs__link">
          
  
    
  
  VMware

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../python/Python%E5%8F%8APycharm%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" class="md-tabs__link">
          
  
    
  
  Python

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../docker/docker-deploy/deploy-blog/docker%20%E5%AE%89%E8%A3%85typecho%E5%8D%9A%E5%AE%A2/" class="md-tabs__link">
          
  
    
  
  Docker

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../routeswitch/Cisio/%E5%8D%95%E8%87%82%E8%B7%AF%E7%94%B1/" class="md-tabs__link">
          
  
    
  
  路由交换

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../synology/VSP%20%E5%AE%89%E8%A3%85%E9%BB%91%E7%BE%A4%E6%99%96/" class="md-tabs__link">
          
  
    
  
  群晖

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../sql/PostgreSQL%20%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/" class="md-tabs__link">
          
  
    
  
  数据库

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../bat/git/" class="md-tabs__link">
          
  
    
  
  批处理

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  K8S

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../git/Git/Git%20Extensions%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/" class="md-tabs__link">
          
  
    
  
  Git

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../essay/" class="md-tabs__link">
          
  
    
  
  随笔

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jerion&#39;s Blog" class="md-nav__button md-logo" aria-label="Jerion's Blog" data-md-component="logo">
      
  <img src="../../assets/octocat.jpg" alt="logo">

    </a>
    Jerion's Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zyx3721/Jerion-MkDoc" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Jerion-MkDoc
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../blog/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    博客
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../linux/Ansible/Ansible%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E4%BD%BF%E7%94%A8/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Linux
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../shell/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Shell
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../vmware/Esxi6.7%E5%AE%89%E8%A3%85MacOS%2010.15.6/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    VMware
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../python/Python%E5%8F%8APycharm%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Python
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    
  
  
    <a href="../../docker/docker-deploy/deploy-blog/docker%20%E5%AE%89%E8%A3%85typecho%E5%8D%9A%E5%AE%A2/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../routeswitch/Cisio/%E5%8D%95%E8%87%82%E8%B7%AF%E7%94%B1/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    路由交换
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../synology/VSP%20%E5%AE%89%E8%A3%85%E9%BB%91%E7%BE%A4%E6%99%96/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    群晖
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../sql/PostgreSQL%20%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    数据库
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../bat/git/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    批处理
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    K8S
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            K8S
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k8s%E5%88%9B%E5%BB%BA%E5%AE%89%E8%A3%85dashboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8s创建安装dashboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    1 K8S集群安装
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    1 K8S集群安装
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#前言" class="md-nav__link">
    <span class="md-ellipsis">
      前言
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#一-硬件和系统" class="md-nav__link">
    <span class="md-ellipsis">
      一 硬件和系统
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#二-基础配置" class="md-nav__link">
    <span class="md-ellipsis">
      二 基础配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二 基础配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-配置主机名" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 配置主机名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-主机名与ip地址解析" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 主机名与IP地址解析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-防火墙--selinux" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 防火墙 &amp; selinux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-时间同步配置" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 时间同步配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-升级操作系统内核" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 升级操作系统内核
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-配置内核转发及网桥过滤" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 配置内核转发及网桥过滤
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-安装ipset及ipvsadm" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 安装ipset及ipvsadm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28-关闭swap分区" class="md-nav__link">
    <span class="md-ellipsis">
      2.8 关闭SWAP分区
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#三-容器运行时-containerd准备" class="md-nav__link">
    <span class="md-ellipsis">
      三 容器运行时 Containerd准备
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三 容器运行时 Containerd准备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-containerd获取" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 Containerd获取
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-containerd配置文件生成并修改" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 Containerd配置文件生成并修改
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-containerd启动及开机自启动" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 Containerd启动及开机自启动
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-runc准备" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 runc准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-ibseccomp准备" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 ibseccomp准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-runc安装" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 runc安装
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#四-k8s集群部署" class="md-nav__link">
    <span class="md-ellipsis">
      四 K8S集群部署
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四 K8S集群部署">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-k8s集群软件yum源准备" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 K8S集群软件YUM源准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-k8s集群软件安装" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 K8S集群软件安装
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-配置kubelet" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 配置kubelet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-集群初始化" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 集群初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.4 集群初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441-替换100年证书kubeadm" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.1 替换100年证书kubeadm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#442-安装go" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.2 安装go
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#443-kubernetes源码编译" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.3 kubernetes源码编译
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#444-校验两个kubeadm-文件md5值可以不校验" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.4 校验两个kubeadm 文件md5值（可以不校验）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#445-替换所有集群主机kubeadm" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.5 替换所有集群主机kubeadm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#446-获取kubernetes-128组件容器镜像" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.6 获取kubernetes 1.28组件容器镜像
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#447-集群初始化" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.7 集群初始化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#五-工作节点加入集群" class="md-nav__link">
    <span class="md-ellipsis">
      五 工作节点加入集群
    </span>
  </a>
  
    <nav class="md-nav" aria-label="五 工作节点加入集群">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-worker节点执行命令加入" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 worker节点执行命令加入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-验证k8s集群节点是否可用" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 验证K8S集群节点是否可用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-验证证书有效期" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 验证证书有效期
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#六-网络插件calico部署" class="md-nav__link">
    <span class="md-ellipsis">
      六 网络插件calico部署
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../git/Git/Git%20Extensions%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Git
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../essay/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    随笔
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#前言" class="md-nav__link">
    <span class="md-ellipsis">
      前言
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#一-硬件和系统" class="md-nav__link">
    <span class="md-ellipsis">
      一 硬件和系统
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#二-基础配置" class="md-nav__link">
    <span class="md-ellipsis">
      二 基础配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二 基础配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-配置主机名" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 配置主机名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-主机名与ip地址解析" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 主机名与IP地址解析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-防火墙--selinux" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 防火墙 &amp; selinux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-时间同步配置" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 时间同步配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-升级操作系统内核" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 升级操作系统内核
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-配置内核转发及网桥过滤" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 配置内核转发及网桥过滤
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-安装ipset及ipvsadm" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 安装ipset及ipvsadm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28-关闭swap分区" class="md-nav__link">
    <span class="md-ellipsis">
      2.8 关闭SWAP分区
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#三-容器运行时-containerd准备" class="md-nav__link">
    <span class="md-ellipsis">
      三 容器运行时 Containerd准备
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三 容器运行时 Containerd准备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-containerd获取" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 Containerd获取
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-containerd配置文件生成并修改" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 Containerd配置文件生成并修改
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-containerd启动及开机自启动" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 Containerd启动及开机自启动
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-runc准备" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 runc准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-ibseccomp准备" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 ibseccomp准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-runc安装" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 runc安装
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#四-k8s集群部署" class="md-nav__link">
    <span class="md-ellipsis">
      四 K8S集群部署
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四 K8S集群部署">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-k8s集群软件yum源准备" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 K8S集群软件YUM源准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-k8s集群软件安装" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 K8S集群软件安装
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-配置kubelet" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 配置kubelet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-集群初始化" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 集群初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.4 集群初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441-替换100年证书kubeadm" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.1 替换100年证书kubeadm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#442-安装go" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.2 安装go
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#443-kubernetes源码编译" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.3 kubernetes源码编译
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#444-校验两个kubeadm-文件md5值可以不校验" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.4 校验两个kubeadm 文件md5值（可以不校验）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#445-替换所有集群主机kubeadm" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.5 替换所有集群主机kubeadm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#446-获取kubernetes-128组件容器镜像" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.6 获取kubernetes 1.28组件容器镜像
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#447-集群初始化" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.7 集群初始化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#五-工作节点加入集群" class="md-nav__link">
    <span class="md-ellipsis">
      五 工作节点加入集群
    </span>
  </a>
  
    <nav class="md-nav" aria-label="五 工作节点加入集群">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-worker节点执行命令加入" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 worker节点执行命令加入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-验证k8s集群节点是否可用" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 验证K8S集群节点是否可用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-验证证书有效期" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 验证证书有效期
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#六-网络插件calico部署" class="md-nav__link">
    <span class="md-ellipsis">
      六 网络插件calico部署
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  
    
      
    
    <a href="https://github.com/zyx3721/Jerion-MkDoc/raw/main/docs/k8s/基于Containerd的K8S集群安装.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="1-k8s集群安装">1 K8S集群安装<a class="headerlink" href="#1-k8s集群安装" title="Permanent link">&para;</a></h1>
<h2 id="前言"><strong>前言</strong><a class="headerlink" href="#前言" title="Permanent link">&para;</a></h2>
<p><strong>Kubeadm-Containerd集群安装</strong></p>
<p>基于containerd容器运行时部署k8s 1.28集群</p>
<h2 id="一-硬件和系统"><strong>一 硬件和系统</strong><a class="headerlink" href="#一-硬件和系统" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>操作系统版本</th>
<th>Centos7.9</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>CPU</th>
<th>内存</th>
<th>硬盘</th>
<th>角色</th>
<th>主机名</th>
</tr>
</thead>
<tbody>
<tr>
<td>2c</td>
<td>4G</td>
<td>30G</td>
<td>master</td>
<td>k8s-master01</td>
</tr>
<tr>
<td>1c</td>
<td>4G</td>
<td>30G</td>
<td>worker(node)</td>
<td>k8s-worker01</td>
</tr>
<tr>
<td>1c</td>
<td>4G</td>
<td>30G</td>
<td>worker(node)</td>
<td>k8s-worker02</td>
</tr>
</tbody>
</table>
<h2 id="二-基础配置"><strong>二 基础配置</strong><a class="headerlink" href="#二-基础配置" title="Permanent link">&para;</a></h2>
<p>​       由于本次使用3台主机完成kubernetes集群部署，其中1台为master节点,名称为k8s-master01;其中2台为worker节点，名称分别为：k8s-worker01及k8s-worker02。</p>
<h3 id="21-配置主机名"><strong>2.1 配置主机名</strong><a class="headerlink" href="#21-配置主机名" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>master节点</th>
<th>hostnamectl set-hostname k8s-master01</th>
<th>192.168.31.150</th>
</tr>
</thead>
<tbody>
<tr>
<td>worker01节点</td>
<td>hostnamectl set-hostname k8s-worker01</td>
<td>192.168.31.151</td>
</tr>
<tr>
<td>worker02节点</td>
<td>hostnamectl set-hostname k8s-worker02</td>
<td>192.168.31.152</td>
</tr>
</tbody>
</table>
<p>三台对应的设备分别执行：</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a>master节点
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a># hostnamectl set-hostname k8s-master01
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a>worker01节点
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos="5 "></span></a># hostnamectl set-hostname k8s-worker01
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos="6 "></span></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos="7 "></span></a>worker02节点
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos="8 "></span></a># hostnamectl set-hostname k8s-worker02
</code></pre></div>
<h3 id="22-主机名与ip地址解析"><strong>2.2 主机名与IP地址解析</strong><a class="headerlink" href="#22-主机名与ip地址解析" title="Permanent link">&para;</a></h3>
<p>所有集群主机均需要进行配置。</p>
<div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos="2 "></span></a><span class="m">192</span>.168.31.150<span class="w"> </span>k8s-master01
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos="3 "></span></a><span class="m">192</span>.168.31.151<span class="w"> </span>k8s-worker01
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos="4 "></span></a><span class="m">192</span>.168.31.152<span class="w"> </span>k8s-worker02
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos="5 "></span></a>EOF
</code></pre></div>
<h3 id="23-防火墙--selinux"><strong>2.3 防火墙 &amp; selinux</strong><a class="headerlink" href="#23-防火墙--selinux" title="Permanent link">&para;</a></h3>
<p>所有主机均需要操作。修改SELinux配置需要重启操作系统。</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a>#关闭防火墙
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a># systemctl disable firewalld &amp;&amp; systemctl stop firewalld &amp;&amp; firewall-cmd --state
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos="4 "></span></a>#关闭selinux
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos="5 "></span></a># sed -ri &#39;s/SELINUX=enforcing/SELINUX=disabled/&#39; /etc/selinux/config        &amp;&amp; getenforce 0
</code></pre></div>
<h3 id="24-时间同步配置"><strong>2.4 时间同步配置</strong><a class="headerlink" href="#24-时间同步配置" title="Permanent link">&para;</a></h3>
<p>所有主机均需要操作。最小化安装系统需要安装ntpdate软件。</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos="1 "></span></a>#安装ntp
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos="2 "></span></a># yum install -y ntpdate 
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos="4 "></span></a>#配置ntp自动更新时间
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos="5 "></span></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos="6 "></span></a># crontab -e
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos="7 "></span></a>0 */1 * * * /usr/sbin/ntpdate time1.aliyun.com
</code></pre></div>
<h3 id="25-升级操作系统内核"><strong>2.5 升级操作系统内核</strong><a class="headerlink" href="#25-升级操作系统内核" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos=" 1 "></span></a>#导入elrepo gpg key
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos=" 2 "></span></a># rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><a href="#__codelineno-4-6"><span class="linenos" data-linenos=" 6 "></span></a>#安装elrepo YUM源仓库
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><a href="#__codelineno-4-7"><span class="linenos" data-linenos=" 7 "></span></a># yum -y install https://www.elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><a href="#__codelineno-4-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><a href="#__codelineno-4-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><a href="#__codelineno-4-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><a href="#__codelineno-4-11"><span class="linenos" data-linenos="11 "></span></a>#安装kernel-ml版本，ml为最新稳定版本，lt为长期维护版本
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><a href="#__codelineno-4-12"><span class="linenos" data-linenos="12 "></span></a># yum --enablerepo=&quot;elrepo-kernel&quot; -y install kernel-lt.x86_64
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><a href="#__codelineno-4-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><a href="#__codelineno-4-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><a href="#__codelineno-4-15"><span class="linenos" data-linenos="15 "></span></a>#设置grub2默认引导为0
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><a href="#__codelineno-4-16"><span class="linenos" data-linenos="16 "></span></a># echo &#39;GRUB_DEFAULT=&quot;0&quot;&#39; | tee -a /etc/default/grub
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><a href="#__codelineno-4-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><a href="#__codelineno-4-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><a href="#__codelineno-4-19"><span class="linenos" data-linenos="19 "></span></a>#重新生成grub2引导文件
<a id="__codelineno-4-20" name="__codelineno-4-20"></a><a href="#__codelineno-4-20"><span class="linenos" data-linenos="20 "></span></a># grub2-mkconfig -o /boot/grub2/grub.cfg
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><a href="#__codelineno-4-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a><a href="#__codelineno-4-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a><a href="#__codelineno-4-23"><span class="linenos" data-linenos="23 "></span></a>重启系统
<a id="__codelineno-4-24" name="__codelineno-4-24"></a><a href="#__codelineno-4-24"><span class="linenos" data-linenos="24 "></span></a># reboot
<a id="__codelineno-4-25" name="__codelineno-4-25"></a><a href="#__codelineno-4-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a><a href="#__codelineno-4-26"><span class="linenos" data-linenos="26 "></span></a>重启后，需要验证内核是否为更新对应的版本
<a id="__codelineno-4-27" name="__codelineno-4-27"></a><a href="#__codelineno-4-27"><span class="linenos" data-linenos="27 "></span></a># uname -r
<a id="__codelineno-4-28" name="__codelineno-4-28"></a><a href="#__codelineno-4-28"><span class="linenos" data-linenos="28 "></span></a>5.4.260-1.el7.elrepo.x86_64
</code></pre></div>
<h3 id="26-配置内核转发及网桥过滤"><strong>2.6 配置内核转发及网桥过滤</strong><a class="headerlink" href="#26-配置内核转发及网桥过滤" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos=" 1 "></span></a>所有主机均需要操作。
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><a href="#__codelineno-5-3"><span class="linenos" data-linenos=" 3 "></span></a>添加网桥过滤及内核转发配置文件
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><a href="#__codelineno-5-4"><span class="linenos" data-linenos=" 4 "></span></a># cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><a href="#__codelineno-5-5"><span class="linenos" data-linenos=" 5 "></span></a>net.bridge.bridge-nf-call-ip6tables = 1
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><a href="#__codelineno-5-6"><span class="linenos" data-linenos=" 6 "></span></a>net.bridge.bridge-nf-call-iptables = 1
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><a href="#__codelineno-5-7"><span class="linenos" data-linenos=" 7 "></span></a>net.ipv4.ip_forward = 1
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><a href="#__codelineno-5-8"><span class="linenos" data-linenos=" 8 "></span></a>vm.swappiness = 0
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><a href="#__codelineno-5-9"><span class="linenos" data-linenos=" 9 "></span></a>EOF
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><a href="#__codelineno-5-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><a href="#__codelineno-5-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><a href="#__codelineno-5-12"><span class="linenos" data-linenos="12 "></span></a>加载br_netfilter模块
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><a href="#__codelineno-5-13"><span class="linenos" data-linenos="13 "></span></a># modprobe br_netfilter
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><a href="#__codelineno-5-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><a href="#__codelineno-5-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><a href="#__codelineno-5-16"><span class="linenos" data-linenos="16 "></span></a>查看是否加载
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><a href="#__codelineno-5-17"><span class="linenos" data-linenos="17 "></span></a># lsmod | grep br_netfilter
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><a href="#__codelineno-5-18"><span class="linenos" data-linenos="18 "></span></a>br_netfilter           22256  0
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><a href="#__codelineno-5-19"><span class="linenos" data-linenos="19 "></span></a>bridge                151336  1 br_netfilter
</code></pre></div>
<h3 id="27-安装ipset及ipvsadm"><strong>2.7 安装ipset及ipvsadm</strong><a class="headerlink" href="#27-安装ipset及ipvsadm" title="Permanent link">&para;</a></h3>
<p>所有主机都需要操作</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos=" 1 "></span></a>安装ipset及ipvsadm
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos=" 2 "></span></a># yum -y install ipset ipvsadm
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><a href="#__codelineno-6-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><a href="#__codelineno-6-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><a href="#__codelineno-6-5"><span class="linenos" data-linenos=" 5 "></span></a>配置ipvsadm模块加载方式
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><a href="#__codelineno-6-6"><span class="linenos" data-linenos=" 6 "></span></a>添加需要加载的模块
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><a href="#__codelineno-6-7"><span class="linenos" data-linenos=" 7 "></span></a># cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><a href="#__codelineno-6-8"><span class="linenos" data-linenos=" 8 "></span></a>#!/bin/bash
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><a href="#__codelineno-6-9"><span class="linenos" data-linenos=" 9 "></span></a>modprobe -- ip_vs
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><a href="#__codelineno-6-10"><span class="linenos" data-linenos="10 "></span></a>modprobe -- ip_vs_rr
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><a href="#__codelineno-6-11"><span class="linenos" data-linenos="11 "></span></a>modprobe -- ip_vs_wrr
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><a href="#__codelineno-6-12"><span class="linenos" data-linenos="12 "></span></a>modprobe -- ip_vs_sh
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><a href="#__codelineno-6-13"><span class="linenos" data-linenos="13 "></span></a>modprobe -- nf_conntrack
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><a href="#__codelineno-6-14"><span class="linenos" data-linenos="14 "></span></a>EOF
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><a href="#__codelineno-6-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><a href="#__codelineno-6-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><a href="#__codelineno-6-17"><span class="linenos" data-linenos="17 "></span></a>授权、运行、检查是否加载
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><a href="#__codelineno-6-18"><span class="linenos" data-linenos="18 "></span></a># chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack
</code></pre></div>
<h3 id="28-关闭swap分区">2.8 关闭SWAP分区<a class="headerlink" href="#28-关闭swap分区" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a>修改完成后需要重启操作系统，如不重启，可临时关闭，命令为
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos="2 "></span></a># swapoff -a
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><a href="#__codelineno-7-4"><span class="linenos" data-linenos="4 "></span></a>永远关闭swap分区，需要重启操作系统
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><a href="#__codelineno-7-5"><span class="linenos" data-linenos="5 "></span></a>sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><a href="#__codelineno-7-6"><span class="linenos" data-linenos="6 "></span></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><a href="#__codelineno-7-7"><span class="linenos" data-linenos="7 "></span></a>重启系统
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><a href="#__codelineno-7-8"><span class="linenos" data-linenos="8 "></span></a># reboot
</code></pre></div>
<h2 id="三-容器运行时-containerd准备"><strong>三 容器运行时 Containerd准备</strong><a class="headerlink" href="#三-容器运行时-containerd准备" title="Permanent link">&para;</a></h2>
<h3 id="31-containerd获取"><strong>3.1 Containerd获取</strong><a class="headerlink" href="#31-containerd获取" title="Permanent link">&para;</a></h3>
<p>Containerd获取部署文件，访问github</p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/a88782be3941c39cfbfc27ba2079e0a7-image-20240424171750167-5d9b81.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424171750167" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/a88782be3941c39cfbfc27ba2079e0a7-image-20240424171750167-5d9b81.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/c69fedb434ae698e1e592e702abadfc9-image-20240424171754208-258d03.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424171754208" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/c69fedb434ae698e1e592e702abadfc9-image-20240424171754208-258d03.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/de84b760fb59e9ee58f15eaf3cfe5399-image-20240424171758669-fb10a5.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424171758669" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/de84b760fb59e9ee58f15eaf3cfe5399-image-20240424171758669-fb10a5.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/0d5908dd8272b3f1fa66894e87d0b93d-image-20240424172120464-8ce5a8.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172120464" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/0d5908dd8272b3f1fa66894e87d0b93d-image-20240424172120464-8ce5a8.png" /></a></p>
<p>下载解压：</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos="1 "></span></a>下载
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos="2 "></span></a># wget https://github.com/containerd/containerd/releases/download/v1.7.3/cri-containerd-1.7.3-linux-amd64.tar.gz
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos="4 "></span></a>解压
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><a href="#__codelineno-8-5"><span class="linenos" data-linenos="5 "></span></a># tar zxvf cri-containerd-1.7.3-linux-amd64.tar.gz -C /
</code></pre></div>
<h3 id="32-containerd配置文件生成并修改"><strong>3.2 Containerd配置文件生成并修改</strong><a class="headerlink" href="#32-containerd配置文件生成并修改" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos="1 "></span></a># mkdir /etc/containerd
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><a href="#__codelineno-9-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><a href="#__codelineno-9-3"><span class="linenos" data-linenos="3 "></span></a># containerd config default &gt; /etc/containerd/config.toml
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><a href="#__codelineno-9-4"><span class="linenos" data-linenos="4 "></span></a>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><a href="#__codelineno-9-5"><span class="linenos" data-linenos="5 "></span></a># vim /etc/containerd/config.toml
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><a href="#__codelineno-9-6"><span class="linenos" data-linenos="6 "></span></a>sandbox_image = &quot;registry.k8s.io/pause:3.9&quot; 由3.8修改为3.9
</code></pre></div>
<h3 id="33-containerd启动及开机自启动"><strong>3.3 Containerd启动及开机自启动</strong><a class="headerlink" href="#33-containerd启动及开机自启动" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos="1 "></span></a># systemctl enable --now containerd
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos="3 "></span></a>验证其版本
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos="4 "></span></a># containerd --version
</code></pre></div>
<h3 id="34-runc准备"><strong>3.4 runc准备</strong><a class="headerlink" href="#34-runc准备" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/f997cee12b1d2d863ebf65acec1c8653-image-20240424172212688-45c20c.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172212688" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/f997cee12b1d2d863ebf65acec1c8653-image-20240424172212688-45c20c.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/7e0dedf872d6df880de9d5d3ffdcaa7e-image-20240424172216113-77bfed.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172216113" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/7e0dedf872d6df880de9d5d3ffdcaa7e-image-20240424172216113-77bfed.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/f8221ef1800ffabdf2494aff6ad59bde-image-20240424172219779-81e23a.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172219779" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/f8221ef1800ffabdf2494aff6ad59bde-image-20240424172219779-81e23a.png" /></a></p>
<h3 id="35-ibseccomp准备"><strong>3.5 ibseccomp准备</strong><a class="headerlink" href="#35-ibseccomp准备" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/1d2bdee071b9d3570e40db76fbee4f72-image-20240424172230719-7afd24.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172230719" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/1d2bdee071b9d3570e40db76fbee4f72-image-20240424172230719-7afd24.png" /></a></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos=" 1 "></span></a>安装 gcc,编译需要
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos=" 2 "></span></a># yum install gcc -y
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><a href="#__codelineno-11-4"><span class="linenos" data-linenos=" 4 "></span></a># wget https://github.com/opencontainers/runc/releases/download/v1.1.5/libseccomp-2.5.4.tar.gz
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><a href="#__codelineno-11-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><a href="#__codelineno-11-6"><span class="linenos" data-linenos=" 6 "></span></a># tar xf libseccomp-2.5.4.tar.gz
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><a href="#__codelineno-11-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><a href="#__codelineno-11-8"><span class="linenos" data-linenos=" 8 "></span></a># cd libseccomp-2.5.4/
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><a href="#__codelineno-11-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><a href="#__codelineno-11-10"><span class="linenos" data-linenos="10 "></span></a># yum install gperf -y
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><a href="#__codelineno-11-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><a href="#__codelineno-11-12"><span class="linenos" data-linenos="12 "></span></a># ./configure
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><a href="#__codelineno-11-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><a href="#__codelineno-11-14"><span class="linenos" data-linenos="14 "></span></a># make &amp;&amp; make install
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><a href="#__codelineno-11-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><a href="#__codelineno-11-16"><span class="linenos" data-linenos="16 "></span></a># find / -name &quot;libseccomp.so&quot;
</code></pre></div>
<h3 id="36-runc安装"><strong>3.6 runc安装</strong><a class="headerlink" href="#36-runc安装" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/8348ac0f28fcdddbf76d56dd5d0d45cb-image-20240424172246854-86d49f.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172246854" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/8348ac0f28fcdddbf76d56dd5d0d45cb-image-20240424172246854-86d49f.png" /></a></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos=" 1 "></span></a># wget https://github.com/opencontainers/runc/releases/download/v1.1.9/runc.amd64
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos=" 3 "></span></a># chmod +x runc.amd64
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><a href="#__codelineno-12-5"><span class="linenos" data-linenos=" 5 "></span></a>查找containerd安装时已安装的runc所在的位置，然后替换
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><a href="#__codelineno-12-6"><span class="linenos" data-linenos=" 6 "></span></a># which runc
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><a href="#__codelineno-12-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><a href="#__codelineno-12-8"><span class="linenos" data-linenos=" 8 "></span></a>替换containerd安装已安装的runc
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><a href="#__codelineno-12-9"><span class="linenos" data-linenos=" 9 "></span></a># mv runc.amd64 /usr/local/sbin/runc
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><a href="#__codelineno-12-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><a href="#__codelineno-12-11"><span class="linenos" data-linenos="11 "></span></a>执行runc命令，如果有命令帮助则为正常
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><a href="#__codelineno-12-12"><span class="linenos" data-linenos="12 "></span></a># runc
</code></pre></div>
<p>​       如果运行runc命令时提示：runc: error while loading shared libraries: libseccomp.so.2: cannot open shared object file: No such file or directory，则表明runc没有找到libseccomp，需要检查libseccomp是否安装，本次安装默认就可以查询到。</p>
<h2 id="四-k8s集群部署"><strong>四 K8S集群部署</strong><a class="headerlink" href="#四-k8s集群部署" title="Permanent link">&para;</a></h2>
<h3 id="41-k8s集群软件yum源准备"><strong>4.1 K8S集群软件YUM源准备</strong><a class="headerlink" href="#41-k8s集群软件yum源准备" title="Permanent link">&para;</a></h3>
<p>google提供YUM源：</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos=" 1 "></span></a># cat &gt; /etc/yum.repos.d/k8s.repo &lt;&lt;EOF
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos=" 2 "></span></a>[kubernetes]
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos=" 3 "></span></a>name=Kubernetes
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><a href="#__codelineno-13-4"><span class="linenos" data-linenos=" 4 "></span></a>baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><a href="#__codelineno-13-5"><span class="linenos" data-linenos=" 5 "></span></a>enabled=1
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><a href="#__codelineno-13-6"><span class="linenos" data-linenos=" 6 "></span></a>gpgcheck=1
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><a href="#__codelineno-13-7"><span class="linenos" data-linenos=" 7 "></span></a>repo_gpgcheck=1
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><a href="#__codelineno-13-8"><span class="linenos" data-linenos=" 8 "></span></a>gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><a href="#__codelineno-13-9"><span class="linenos" data-linenos=" 9 "></span></a>        https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><a href="#__codelineno-13-10"><span class="linenos" data-linenos="10 "></span></a>EOF
</code></pre></div>
<p>阿里云提供YUM源：</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos="1 "></span></a># cat &gt; /etc/yum.repos.d/k8s.repo &lt;&lt;EOF
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><a href="#__codelineno-14-2"><span class="linenos" data-linenos="2 "></span></a>[kubernetes]
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><a href="#__codelineno-14-3"><span class="linenos" data-linenos="3 "></span></a>name=Kubernetes
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><a href="#__codelineno-14-4"><span class="linenos" data-linenos="4 "></span></a>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><a href="#__codelineno-14-5"><span class="linenos" data-linenos="5 "></span></a>enabled=1
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><a href="#__codelineno-14-6"><span class="linenos" data-linenos="6 "></span></a>gpgcheck=0
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><a href="#__codelineno-14-7"><span class="linenos" data-linenos="7 "></span></a>repo_gpgcheck=0
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><a href="#__codelineno-14-8"><span class="linenos" data-linenos="8 "></span></a>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><a href="#__codelineno-14-9"><span class="linenos" data-linenos="9 "></span></a>EOF
</code></pre></div>
<h3 id="42-k8s集群软件安装"><strong>4.2 K8S集群软件安装</strong><a class="headerlink" href="#42-k8s集群软件安装" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos=" 1 "></span></a>默认安装
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><a href="#__codelineno-15-2"><span class="linenos" data-linenos=" 2 "></span></a># yum -y install  kubeadm  kubelet kubectl
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><a href="#__codelineno-15-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><a href="#__codelineno-15-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><a href="#__codelineno-15-5"><span class="linenos" data-linenos=" 5 "></span></a>查看指定版本
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><a href="#__codelineno-15-6"><span class="linenos" data-linenos=" 6 "></span></a># yum list kubeadm.x86_64 --showduplicates | sort -r
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><a href="#__codelineno-15-7"><span class="linenos" data-linenos=" 7 "></span></a># yum list kubelet.x86_64 --showduplicates | sort -r
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><a href="#__codelineno-15-8"><span class="linenos" data-linenos=" 8 "></span></a># yum list kubectl.x86_64 --showduplicates | sort -r
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><a href="#__codelineno-15-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><a href="#__codelineno-15-10"><span class="linenos" data-linenos="10 "></span></a>安装指定版本
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><a href="#__codelineno-15-11"><span class="linenos" data-linenos="11 "></span></a># yum -y install  kubeadm-1.28.X-0  kubelet-1.28.X-0 kubectl-1.28.X-0
</code></pre></div>
<h3 id="43-配置kubelet"><strong>4.3 配置kubelet</strong><a class="headerlink" href="#43-配置kubelet" title="Permanent link">&para;</a></h3>
<p>​       为了实现docker使用的cgroupdriver与kubelet使用的cgroup的一致性，建议修改如下文件内容。</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos="1 "></span></a># vim /etc/sysconfig/kubelet
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos="2 "></span></a>KUBELET_EXTRA_ARGS=&quot;--cgroup-driver=systemd&quot;
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos="4 "></span></a>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><a href="#__codelineno-16-5"><span class="linenos" data-linenos="5 "></span></a>设置kubelet为开机自启动即可，由于没有生成配置文件，集群初始化后自动启动
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><a href="#__codelineno-16-6"><span class="linenos" data-linenos="6 "></span></a># systemctl enable kubelet
</code></pre></div>
<h3 id="44-集群初始化"><strong>4.4 集群初始化</strong><a class="headerlink" href="#44-集群初始化" title="Permanent link">&para;</a></h3>
<h4 id="441-替换100年证书kubeadm"><strong>4.4.1 替换100年证书kubeadm</strong><a class="headerlink" href="#441-替换100年证书kubeadm" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos="1 "></span></a># which kubeadm
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><a href="#__codelineno-17-2"><span class="linenos" data-linenos="2 "></span></a>/usr/bin/kubeadm
</code></pre></div>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/3d3d8b6fc39f0c06e0d5a40f8b96d0ef-image-20240424172346875-5fe805.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172346875" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/3d3d8b6fc39f0c06e0d5a40f8b96d0ef-image-20240424172346875-5fe805.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/5ca4a89117b4e8ef043124bf4d190938-image-20240424172349698-173586.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172349698" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/5ca4a89117b4e8ef043124bf4d190938-image-20240424172349698-173586.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/e7252003f99cd2883001f13c8198a19e-image-20240424172354152-b5ad4f.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172354152" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/e7252003f99cd2883001f13c8198a19e-image-20240424172354152-b5ad4f.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/0f46ade817a28ccb9573f0a6b431fdda-image-20240424172400130-4cad06.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172400130" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/0f46ade817a28ccb9573f0a6b431fdda-image-20240424172400130-4cad06.png" /></a></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos=" 1 "></span></a>下载
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos=" 2 "></span></a># wget https://github.com/kubernetes/kubernetes/archive/refs/tags/v1.28.0.tar.gz
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos=" 4 "></span></a># ls
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><a href="#__codelineno-18-5"><span class="linenos" data-linenos=" 5 "></span></a>v1.28.0.tar.gz
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><a href="#__codelineno-18-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><a href="#__codelineno-18-7"><span class="linenos" data-linenos=" 7 "></span></a>解压
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><a href="#__codelineno-18-8"><span class="linenos" data-linenos=" 8 "></span></a># tar zxvf v1.28.0.tar.gz
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><a href="#__codelineno-18-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><a href="#__codelineno-18-10"><span class="linenos" data-linenos="10 "></span></a># ls
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><a href="#__codelineno-18-11"><span class="linenos" data-linenos="11 "></span></a>kubernetes-1.28.0
</code></pre></div>
<p>修改kubernetes源码</p>
<p>修改CA证书为100年有效期（默认为10年）</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos=" 1 "></span></a>[root@k8s-master01 ~]# vim kubernetes-1.28.0/staging/src/k8s.io/client-go/util/cert/cert.go
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><a href="#__codelineno-19-3"><span class="linenos" data-linenos=" 3 "></span></a> 72         tmpl := x509.Certificate{
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><a href="#__codelineno-19-4"><span class="linenos" data-linenos=" 4 "></span></a> 73                 SerialNumber: serial,
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><a href="#__codelineno-19-5"><span class="linenos" data-linenos=" 5 "></span></a> 74                 Subject: pkix.Name{
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><a href="#__codelineno-19-6"><span class="linenos" data-linenos=" 6 "></span></a> 75                         CommonName:   cfg.CommonName,
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><a href="#__codelineno-19-7"><span class="linenos" data-linenos=" 7 "></span></a> 76                         Organization: cfg.Organization,
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><a href="#__codelineno-19-8"><span class="linenos" data-linenos=" 8 "></span></a> 77                 },
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><a href="#__codelineno-19-9"><span class="linenos" data-linenos=" 9 "></span></a> 78                 DNSNames:              []string{cfg.CommonName},
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><a href="#__codelineno-19-10"><span class="linenos" data-linenos="10 "></span></a> 79                 NotBefore:             notBefore,
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><a href="#__codelineno-19-11"><span class="linenos" data-linenos="11 "></span></a> 80                 NotAfter:              now.Add(duration365d * 100).UTC(),
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><a href="#__codelineno-19-12"><span class="linenos" data-linenos="12 "></span></a> 81                 KeyUsage:              x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature | x509.KeyUsageCertSign,
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><a href="#__codelineno-19-13"><span class="linenos" data-linenos="13 "></span></a> 82                 BasicConstraintsValid: true,
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><a href="#__codelineno-19-14"><span class="linenos" data-linenos="14 "></span></a> 83                 IsCA:                  true,
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><a href="#__codelineno-19-15"><span class="linenos" data-linenos="15 "></span></a> 84         }
</code></pre></div>
<blockquote>
<p>修改说明：</p>
<p>把文件中80行，10修改为100即可 。</p>
</blockquote>
<p>修改kubeadm证书有效期为100年（默认为1年）</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos=" 1 "></span></a>[root@k8s-master01 ~]# vim kubernetes-1.28.0/cmd/kubeadm/app/constants/constants.go
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><a href="#__codelineno-20-2"><span class="linenos" data-linenos=" 2 "></span></a> ......
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><a href="#__codelineno-20-3"><span class="linenos" data-linenos=" 3 "></span></a> 37 const (
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><a href="#__codelineno-20-4"><span class="linenos" data-linenos=" 4 "></span></a> 38         // KubernetesDir is the directory Kubernetes owns for storing various configuration files
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><a href="#__codelineno-20-5"><span class="linenos" data-linenos=" 5 "></span></a> 39         KubernetesDir = &quot;/etc/kubernetes&quot;
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><a href="#__codelineno-20-6"><span class="linenos" data-linenos=" 6 "></span></a> 40         // ManifestsSubDirName defines directory name to store manifests
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><a href="#__codelineno-20-7"><span class="linenos" data-linenos=" 7 "></span></a> 41         ManifestsSubDirName = &quot;manifests&quot;
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><a href="#__codelineno-20-8"><span class="linenos" data-linenos=" 8 "></span></a> 42         // TempDirForKubeadm defines temporary directory for kubeadm
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><a href="#__codelineno-20-9"><span class="linenos" data-linenos=" 9 "></span></a> 43         // should be joined with KubernetesDir.
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><a href="#__codelineno-20-10"><span class="linenos" data-linenos="10 "></span></a> 44         TempDirForKubeadm = &quot;tmp&quot;
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><a href="#__codelineno-20-11"><span class="linenos" data-linenos="11 "></span></a> 45
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><a href="#__codelineno-20-12"><span class="linenos" data-linenos="12 "></span></a> 46         // CertificateBackdate defines the offset applied to notBefore for CA certificates generated by kubeadm
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><a href="#__codelineno-20-13"><span class="linenos" data-linenos="13 "></span></a> 47         CertificateBackdate = time.Minute * 5
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><a href="#__codelineno-20-14"><span class="linenos" data-linenos="14 "></span></a> 48         // CertificateValidity defines the validity for all the signed certificates generated by kubeadm
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><a href="#__codelineno-20-15"><span class="linenos" data-linenos="15 "></span></a> 49         CertificateValidity = time.Hour * 24 * 365 * 100
</code></pre></div>
<blockquote>
<p>修改说明：</p>
<p>把CertificateValidity = time.Hour * 24 * 365 修改为：CertificateValidity = time.Hour * 24 * 365 * 100</p>
</blockquote>
<h4 id="442-安装go"><strong>4.4.2 安装go</strong><a class="headerlink" href="#442-安装go" title="Permanent link">&para;</a></h4>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/15443260bafaa6ddd6e8535f0b890014-image-20240424172454833-a35bb4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172454833" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/15443260bafaa6ddd6e8535f0b890014-image-20240424172454833-a35bb4.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/9e866e539f7b2a27881cd76d9bef5ec4-image-20240424172501682-751d0d.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172501682" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/9e866e539f7b2a27881cd76d9bef5ec4-image-20240424172501682-751d0d.png" /></a></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos=" 1 "></span></a>wget https://go.dev/dl/go1.21.0.linux-amd64.tar.gz
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos=" 3 "></span></a>[root@k8s-master01 ~]# tar xf go1.21.0.linux-amd64.tar.gz
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><a href="#__codelineno-21-5"><span class="linenos" data-linenos=" 5 "></span></a>[root@k8s-master01 ~]# mv go /usr/local/go
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><a href="#__codelineno-21-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><a href="#__codelineno-21-7"><span class="linenos" data-linenos=" 7 "></span></a>[root@k8s-master01 ~]# vim /etc/profile
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><a href="#__codelineno-21-8"><span class="linenos" data-linenos=" 8 "></span></a>[root@k8s-master01 ~]# cat /etc/profile
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><a href="#__codelineno-21-9"><span class="linenos" data-linenos=" 9 "></span></a>export PATH=$PATH:/usr/local/go/bin
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><a href="#__codelineno-21-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><a href="#__codelineno-21-11"><span class="linenos" data-linenos="11 "></span></a>[root@k8s-master01 ~]# source /etc/profile
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><a href="#__codelineno-21-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><a href="#__codelineno-21-13"><span class="linenos" data-linenos="13 "></span></a>[root@k8s-master01 ~]# go version
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><a href="#__codelineno-21-14"><span class="linenos" data-linenos="14 "></span></a>go version go1.21.0 linux/amd64
</code></pre></div>
<h4 id="443-kubernetes源码编译"><strong>4.4.3 kubernetes源码编译</strong><a class="headerlink" href="#443-kubernetes源码编译" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos=" 1 "></span></a>安装rsync,编译要用
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><a href="#__codelineno-22-2"><span class="linenos" data-linenos=" 2 "></span></a>yum install rsync -y  
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><a href="#__codelineno-22-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><a href="#__codelineno-22-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><a href="#__codelineno-22-5"><span class="linenos" data-linenos=" 5 "></span></a>[root@k8s-master01 ~]# cd kubernetes-1.28.0/
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><a href="#__codelineno-22-6"><span class="linenos" data-linenos=" 6 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# make all WHAT=cmd/kubeadm GOFLAGS=-v
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><a href="#__codelineno-22-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><a href="#__codelineno-22-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><a href="#__codelineno-22-9"><span class="linenos" data-linenos=" 9 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# ls
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><a href="#__codelineno-22-10"><span class="linenos" data-linenos="10 "></span></a>_output
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><a href="#__codelineno-22-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><a href="#__codelineno-22-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><a href="#__codelineno-22-13"><span class="linenos" data-linenos="13 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# ls _output/
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><a href="#__codelineno-22-14"><span class="linenos" data-linenos="14 "></span></a>bin  local
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><a href="#__codelineno-22-15"><span class="linenos" data-linenos="15 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# ls _output/bin/
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><a href="#__codelineno-22-16"><span class="linenos" data-linenos="16 "></span></a>kubeadm  ncpu
</code></pre></div>
<h4 id="444-校验两个kubeadm-文件md5值可以不校验"><strong>4.4.4 校验两个kubeadm 文件md5值（可以不校验）</strong><a class="headerlink" href="#444-校验两个kubeadm-文件md5值可以不校验" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos="1 "></span></a>[root@k8s-master01 bin]# md5sum kubeadm 
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><a href="#__codelineno-23-2"><span class="linenos" data-linenos="2 "></span></a>1d4728a043de707093644ffbd949bca9  kubeadm
</code></pre></div>
<h4 id="445-替换所有集群主机kubeadm"><strong>4.4.5 替换所有集群主机kubeadm</strong><a class="headerlink" href="#445-替换所有集群主机kubeadm" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos=" 1 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# which kubeadm
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><a href="#__codelineno-24-2"><span class="linenos" data-linenos=" 2 "></span></a>/usr/bin/kubeadm
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><a href="#__codelineno-24-3"><span class="linenos" data-linenos=" 3 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# rm -rf `which kubeadm`
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><a href="#__codelineno-24-4"><span class="linenos" data-linenos=" 4 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# cp _output/bin/kubeadm /usr/bin/kubeadm
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><a href="#__codelineno-24-5"><span class="linenos" data-linenos=" 5 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# which kubeadm
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><a href="#__codelineno-24-6"><span class="linenos" data-linenos=" 6 "></span></a>/usr/bin/kubeadm
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><a href="#__codelineno-24-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><a href="#__codelineno-24-8"><span class="linenos" data-linenos=" 8 "></span></a>worker01和worker02删除
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><a href="#__codelineno-24-9"><span class="linenos" data-linenos=" 9 "></span></a>[root@k8s-worker01 ~]# rm -rf `which kubeadm`
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><a href="#__codelineno-24-10"><span class="linenos" data-linenos="10 "></span></a>[root@k8s-worker02 ~]# rm -rf `which kubeadm`
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><a href="#__codelineno-24-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><a href="#__codelineno-24-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><a href="#__codelineno-24-13"><span class="linenos" data-linenos="13 "></span></a>复制文件到worker
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><a href="#__codelineno-24-14"><span class="linenos" data-linenos="14 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# scp _output/bin/kubeadm 192.168.31.151:/usr/bin/kubeadm
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><a href="#__codelineno-24-15"><span class="linenos" data-linenos="15 "></span></a>[root@k8s-master01 kubernetes-1.28.0]# scp _output/bin/kubeadm 192.168.31.152:/usr/bin/kubeadm
</code></pre></div>
<h4 id="446-获取kubernetes-128组件容器镜像"><strong>4.4.6 获取kubernetes 1.28组件容器镜像</strong><a class="headerlink" href="#446-获取kubernetes-128组件容器镜像" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos=" 1 "></span></a># kubeadm config images list
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><a href="#__codelineno-25-2"><span class="linenos" data-linenos=" 2 "></span></a>registry.k8s.io/kube-apiserver:v1.28.0
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><a href="#__codelineno-25-3"><span class="linenos" data-linenos=" 3 "></span></a>registry.k8s.io/kube-controller-manager:v1.28.0
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><a href="#__codelineno-25-4"><span class="linenos" data-linenos=" 4 "></span></a>registry.k8s.io/kube-scheduler:v1.28.0
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><a href="#__codelineno-25-5"><span class="linenos" data-linenos=" 5 "></span></a>registry.k8s.io/kube-proxy:v1.28.0
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><a href="#__codelineno-25-6"><span class="linenos" data-linenos=" 6 "></span></a>registry.k8s.io/pause:3.9
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><a href="#__codelineno-25-7"><span class="linenos" data-linenos=" 7 "></span></a>registry.k8s.io/etcd:3.5.9-0
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><a href="#__codelineno-25-8"><span class="linenos" data-linenos=" 8 "></span></a>registry.k8s.io/coredns/coredns:v1.10.1
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><a href="#__codelineno-25-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><a href="#__codelineno-25-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><a href="#__codelineno-25-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><a href="#__codelineno-25-12"><span class="linenos" data-linenos="12 "></span></a>拉取镜像
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><a href="#__codelineno-25-13"><span class="linenos" data-linenos="13 "></span></a># kubeadm config images pull
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><a href="#__codelineno-25-14"><span class="linenos" data-linenos="14 "></span></a>[config/images] Pulled registry.k8s.io/kube-apiserver:v1.28.3
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><a href="#__codelineno-25-15"><span class="linenos" data-linenos="15 "></span></a>[config/images] Pulled registry.k8s.io/kube-controller-manager:v1.28.3
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><a href="#__codelineno-25-16"><span class="linenos" data-linenos="16 "></span></a>[config/images] Pulled registry.k8s.io/kube-scheduler:v1.28.3
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><a href="#__codelineno-25-17"><span class="linenos" data-linenos="17 "></span></a>[config/images] Pulled registry.k8s.io/kube-proxy:v1.28.3
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><a href="#__codelineno-25-18"><span class="linenos" data-linenos="18 "></span></a>[config/images] Pulled registry.k8s.io/pause:3.9
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><a href="#__codelineno-25-19"><span class="linenos" data-linenos="19 "></span></a>[config/images] Pulled registry.k8s.io/etcd:3.5.9-0
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><a href="#__codelineno-25-20"><span class="linenos" data-linenos="20 "></span></a>[config/images] Pulled registry.k8s.io/coredns/coredns:v1.10.1
</code></pre></div>
<h4 id="447-集群初始化"><strong>4.4.7 集群初始化</strong><a class="headerlink" href="#447-集群初始化" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos="1 "></span></a>初始化
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><a href="#__codelineno-26-2"><span class="linenos" data-linenos="2 "></span></a># kubeadm init --kubernetes-version=v1.28.0 --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.31.150  --cri-socket unix:///var/run/containerd/containerd.sock
</code></pre></div>
<p>如果只用Containerd，不用docker，可以不加&ndash;cri-socket unix:///var/run/containerd/containerd.sock</p>
<blockquote>
<p>在Kubernetes（通常简称为K8s）中，<strong>&ndash;cri-socket</strong> 参数用于指定容器运行时（Container Runtime Interface，CRI）的套接字地址。CRI是Kubernetes与容器运行时之间的接口，允许Kubernetes与不同的容器运行时进行通信，如Docker、containerd等。</p>
</blockquote>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos=" 1 "></span></a>[root@k8s-master01 ~]# kubeadm init --kubernetes-version=v1.28.0 --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.31.150  --cri-socket unix:///var/run/containerd/containerd.sock
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><a href="#__codelineno-27-2"><span class="linenos" data-linenos=" 2 "></span></a>[init] Using Kubernetes version: v1.28.0
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><a href="#__codelineno-27-3"><span class="linenos" data-linenos=" 3 "></span></a>[preflight] Running pre-flight checks
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><a href="#__codelineno-27-4"><span class="linenos" data-linenos=" 4 "></span></a>[preflight] Pulling images required for setting up a Kubernetes cluster
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><a href="#__codelineno-27-5"><span class="linenos" data-linenos=" 5 "></span></a>[preflight] This might take a minute or two, depending on the speed of your internet connection
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><a href="#__codelineno-27-6"><span class="linenos" data-linenos=" 6 "></span></a>[preflight] You can also perform this action in beforehand using &#39;kubeadm config images pull&#39;
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><a href="#__codelineno-27-7"><span class="linenos" data-linenos=" 7 "></span></a>[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><a href="#__codelineno-27-8"><span class="linenos" data-linenos=" 8 "></span></a>[certs] Generating &quot;ca&quot; certificate and key
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><a href="#__codelineno-27-9"><span class="linenos" data-linenos=" 9 "></span></a>[certs] Generating &quot;apiserver&quot; certificate and key
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><a href="#__codelineno-27-10"><span class="linenos" data-linenos="10 "></span></a>[certs] apiserver serving cert is signed for DNS names [k8s-master01 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.31.150]
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><a href="#__codelineno-27-11"><span class="linenos" data-linenos="11 "></span></a>[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key
<a id="__codelineno-27-12" name="__codelineno-27-12"></a><a href="#__codelineno-27-12"><span class="linenos" data-linenos="12 "></span></a>[certs] Generating &quot;front-proxy-ca&quot; certificate and key
<a id="__codelineno-27-13" name="__codelineno-27-13"></a><a href="#__codelineno-27-13"><span class="linenos" data-linenos="13 "></span></a>[certs] Generating &quot;front-proxy-client&quot; certificate and key
<a id="__codelineno-27-14" name="__codelineno-27-14"></a><a href="#__codelineno-27-14"><span class="linenos" data-linenos="14 "></span></a>[certs] Generating &quot;etcd/ca&quot; certificate and key
<a id="__codelineno-27-15" name="__codelineno-27-15"></a><a href="#__codelineno-27-15"><span class="linenos" data-linenos="15 "></span></a>[certs] Generating &quot;etcd/server&quot; certificate and key
<a id="__codelineno-27-16" name="__codelineno-27-16"></a><a href="#__codelineno-27-16"><span class="linenos" data-linenos="16 "></span></a>[certs] etcd/server serving cert is signed for DNS names [k8s-master01 localhost] and IPs [192.168.31.150 127.0.0.1 ::1]
<a id="__codelineno-27-17" name="__codelineno-27-17"></a><a href="#__codelineno-27-17"><span class="linenos" data-linenos="17 "></span></a>[certs] Generating &quot;etcd/peer&quot; certificate and key
<a id="__codelineno-27-18" name="__codelineno-27-18"></a><a href="#__codelineno-27-18"><span class="linenos" data-linenos="18 "></span></a>[certs] etcd/peer serving cert is signed for DNS names [k8s-master01 localhost] and IPs [192.168.31.150 127.0.0.1 ::1]
<a id="__codelineno-27-19" name="__codelineno-27-19"></a><a href="#__codelineno-27-19"><span class="linenos" data-linenos="19 "></span></a>[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key
<a id="__codelineno-27-20" name="__codelineno-27-20"></a><a href="#__codelineno-27-20"><span class="linenos" data-linenos="20 "></span></a>[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key
<a id="__codelineno-27-21" name="__codelineno-27-21"></a><a href="#__codelineno-27-21"><span class="linenos" data-linenos="21 "></span></a>[certs] Generating &quot;sa&quot; key and public key
<a id="__codelineno-27-22" name="__codelineno-27-22"></a><a href="#__codelineno-27-22"><span class="linenos" data-linenos="22 "></span></a>[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;
<a id="__codelineno-27-23" name="__codelineno-27-23"></a><a href="#__codelineno-27-23"><span class="linenos" data-linenos="23 "></span></a>[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file
<a id="__codelineno-27-24" name="__codelineno-27-24"></a><a href="#__codelineno-27-24"><span class="linenos" data-linenos="24 "></span></a>[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file
<a id="__codelineno-27-25" name="__codelineno-27-25"></a><a href="#__codelineno-27-25"><span class="linenos" data-linenos="25 "></span></a>[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file
<a id="__codelineno-27-26" name="__codelineno-27-26"></a><a href="#__codelineno-27-26"><span class="linenos" data-linenos="26 "></span></a>[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file
<a id="__codelineno-27-27" name="__codelineno-27-27"></a><a href="#__codelineno-27-27"><span class="linenos" data-linenos="27 "></span></a>[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;
<a id="__codelineno-27-28" name="__codelineno-27-28"></a><a href="#__codelineno-27-28"><span class="linenos" data-linenos="28 "></span></a>[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;
<a id="__codelineno-27-29" name="__codelineno-27-29"></a><a href="#__codelineno-27-29"><span class="linenos" data-linenos="29 "></span></a>[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;
<a id="__codelineno-27-30" name="__codelineno-27-30"></a><a href="#__codelineno-27-30"><span class="linenos" data-linenos="30 "></span></a>[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;
<a id="__codelineno-27-31" name="__codelineno-27-31"></a><a href="#__codelineno-27-31"><span class="linenos" data-linenos="31 "></span></a>[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;
<a id="__codelineno-27-32" name="__codelineno-27-32"></a><a href="#__codelineno-27-32"><span class="linenos" data-linenos="32 "></span></a>[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
<a id="__codelineno-27-33" name="__codelineno-27-33"></a><a href="#__codelineno-27-33"><span class="linenos" data-linenos="33 "></span></a>[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
<a id="__codelineno-27-34" name="__codelineno-27-34"></a><a href="#__codelineno-27-34"><span class="linenos" data-linenos="34 "></span></a>[kubelet-start] Starting the kubelet
<a id="__codelineno-27-35" name="__codelineno-27-35"></a><a href="#__codelineno-27-35"><span class="linenos" data-linenos="35 "></span></a>[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s
<a id="__codelineno-27-36" name="__codelineno-27-36"></a><a href="#__codelineno-27-36"><span class="linenos" data-linenos="36 "></span></a>[kubelet-check] Initial timeout of 40s passed.
<a id="__codelineno-27-37" name="__codelineno-27-37"></a><a href="#__codelineno-27-37"><span class="linenos" data-linenos="37 "></span></a>[apiclient] All control plane components are healthy after 103.502051 seconds
<a id="__codelineno-27-38" name="__codelineno-27-38"></a><a href="#__codelineno-27-38"><span class="linenos" data-linenos="38 "></span></a>[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
<a id="__codelineno-27-39" name="__codelineno-27-39"></a><a href="#__codelineno-27-39"><span class="linenos" data-linenos="39 "></span></a>[kubelet] Creating a ConfigMap &quot;kubelet-config&quot; in namespace kube-system with the configuration for the kubelets in the cluster
<a id="__codelineno-27-40" name="__codelineno-27-40"></a><a href="#__codelineno-27-40"><span class="linenos" data-linenos="40 "></span></a>[upload-certs] Skipping phase. Please see --upload-certs
<a id="__codelineno-27-41" name="__codelineno-27-41"></a><a href="#__codelineno-27-41"><span class="linenos" data-linenos="41 "></span></a>[mark-control-plane] Marking the node k8s-master01 as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]
<a id="__codelineno-27-42" name="__codelineno-27-42"></a><a href="#__codelineno-27-42"><span class="linenos" data-linenos="42 "></span></a>[mark-control-plane] Marking the node k8s-master01 as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]
<a id="__codelineno-27-43" name="__codelineno-27-43"></a><a href="#__codelineno-27-43"><span class="linenos" data-linenos="43 "></span></a>[bootstrap-token] Using token: 2n0t62.gvuu8x3zui9o8xnc
<a id="__codelineno-27-44" name="__codelineno-27-44"></a><a href="#__codelineno-27-44"><span class="linenos" data-linenos="44 "></span></a>[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
<a id="__codelineno-27-45" name="__codelineno-27-45"></a><a href="#__codelineno-27-45"><span class="linenos" data-linenos="45 "></span></a>[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes
<a id="__codelineno-27-46" name="__codelineno-27-46"></a><a href="#__codelineno-27-46"><span class="linenos" data-linenos="46 "></span></a>[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
<a id="__codelineno-27-47" name="__codelineno-27-47"></a><a href="#__codelineno-27-47"><span class="linenos" data-linenos="47 "></span></a>[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<a id="__codelineno-27-48" name="__codelineno-27-48"></a><a href="#__codelineno-27-48"><span class="linenos" data-linenos="48 "></span></a>[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
<a id="__codelineno-27-49" name="__codelineno-27-49"></a><a href="#__codelineno-27-49"><span class="linenos" data-linenos="49 "></span></a>[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace
<a id="__codelineno-27-50" name="__codelineno-27-50"></a><a href="#__codelineno-27-50"><span class="linenos" data-linenos="50 "></span></a>[kubelet-finalize] Updating &quot;/etc/kubernetes/kubelet.conf&quot; to point to a rotatable kubelet client certificate and key
<a id="__codelineno-27-51" name="__codelineno-27-51"></a><a href="#__codelineno-27-51"><span class="linenos" data-linenos="51 "></span></a>[addons] Applied essential addon: CoreDNS
<a id="__codelineno-27-52" name="__codelineno-27-52"></a><a href="#__codelineno-27-52"><span class="linenos" data-linenos="52 "></span></a>[addons] Applied essential addon: kube-proxy
<a id="__codelineno-27-53" name="__codelineno-27-53"></a><a href="#__codelineno-27-53"><span class="linenos" data-linenos="53 "></span></a>
<a id="__codelineno-27-54" name="__codelineno-27-54"></a><a href="#__codelineno-27-54"><span class="linenos" data-linenos="54 "></span></a>Your Kubernetes control-plane has initialized successfully!
<a id="__codelineno-27-55" name="__codelineno-27-55"></a><a href="#__codelineno-27-55"><span class="linenos" data-linenos="55 "></span></a>
<a id="__codelineno-27-56" name="__codelineno-27-56"></a><a href="#__codelineno-27-56"><span class="linenos" data-linenos="56 "></span></a>To start using your cluster, you need to run the following as a regular user:
<a id="__codelineno-27-57" name="__codelineno-27-57"></a><a href="#__codelineno-27-57"><span class="linenos" data-linenos="57 "></span></a>
<a id="__codelineno-27-58" name="__codelineno-27-58"></a><a href="#__codelineno-27-58"><span class="linenos" data-linenos="58 "></span></a>  mkdir -p $HOME/.kube
<a id="__codelineno-27-59" name="__codelineno-27-59"></a><a href="#__codelineno-27-59"><span class="linenos" data-linenos="59 "></span></a>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
<a id="__codelineno-27-60" name="__codelineno-27-60"></a><a href="#__codelineno-27-60"><span class="linenos" data-linenos="60 "></span></a>  sudo chown $(id -u):$(id -g) $HOME/.kube/config
<a id="__codelineno-27-61" name="__codelineno-27-61"></a><a href="#__codelineno-27-61"><span class="linenos" data-linenos="61 "></span></a>
<a id="__codelineno-27-62" name="__codelineno-27-62"></a><a href="#__codelineno-27-62"><span class="linenos" data-linenos="62 "></span></a>Alternatively, if you are the root user, you can run:
<a id="__codelineno-27-63" name="__codelineno-27-63"></a><a href="#__codelineno-27-63"><span class="linenos" data-linenos="63 "></span></a>
<a id="__codelineno-27-64" name="__codelineno-27-64"></a><a href="#__codelineno-27-64"><span class="linenos" data-linenos="64 "></span></a>  export KUBECONFIG=/etc/kubernetes/admin.conf
<a id="__codelineno-27-65" name="__codelineno-27-65"></a><a href="#__codelineno-27-65"><span class="linenos" data-linenos="65 "></span></a>
<a id="__codelineno-27-66" name="__codelineno-27-66"></a><a href="#__codelineno-27-66"><span class="linenos" data-linenos="66 "></span></a>You should now deploy a pod network to the cluster.
<a id="__codelineno-27-67" name="__codelineno-27-67"></a><a href="#__codelineno-27-67"><span class="linenos" data-linenos="67 "></span></a>Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
<a id="__codelineno-27-68" name="__codelineno-27-68"></a><a href="#__codelineno-27-68"><span class="linenos" data-linenos="68 "></span></a>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
<a id="__codelineno-27-69" name="__codelineno-27-69"></a><a href="#__codelineno-27-69"><span class="linenos" data-linenos="69 "></span></a>
<a id="__codelineno-27-70" name="__codelineno-27-70"></a><a href="#__codelineno-27-70"><span class="linenos" data-linenos="70 "></span></a>Then you can join any number of worker nodes by running the following on each as root:
<a id="__codelineno-27-71" name="__codelineno-27-71"></a><a href="#__codelineno-27-71"><span class="linenos" data-linenos="71 "></span></a>
<a id="__codelineno-27-72" name="__codelineno-27-72"></a><a href="#__codelineno-27-72"><span class="linenos" data-linenos="72 "></span></a>kubeadm join 192.168.31.150:6443 --token 2n0t62.gvuu8x3zui9o8xnc \
<a id="__codelineno-27-73" name="__codelineno-27-73"></a><a href="#__codelineno-27-73"><span class="linenos" data-linenos="73 "></span></a>        --discovery-token-ca-cert-hash sha256:d294c082cc7e0d5f620fb10e527a8a7cb4cb6ccd8dc45ffaf2cddd9bd3016695
</code></pre></div>
<h2 id="五-工作节点加入集群"><strong>五 工作节点加入集群</strong><a class="headerlink" href="#五-工作节点加入集群" title="Permanent link">&para;</a></h2>
<h3 id="51-worker节点执行命令加入"><strong>5.1 worker节点执行命令加入</strong><a class="headerlink" href="#51-worker节点执行命令加入" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos="1 "></span></a>kubeadm join 192.168.31.150:6443 --token 2n0t62.gvuu8x3zui9o8xnc \
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><a href="#__codelineno-28-2"><span class="linenos" data-linenos="2 "></span></a>        --discovery-token-ca-cert-hash sha256:d294c082cc7e0d5f620fb10e527a8a7cb4cb6
</code></pre></div>
<p>kubectl get nodes使用报错</p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/b340487bf8065f781e19e03755e0d98c-image-20240424172827474-f95632.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172827474" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/b340487bf8065f781e19e03755e0d98c-image-20240424172827474-f95632.png" /></a></p>
<p>报错需要如下配置：</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos="1 "></span></a>mkdir -p $HOME/.kube
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos="2 "></span></a>cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><a href="#__codelineno-29-3"><span class="linenos" data-linenos="3 "></span></a>chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre></div>
<h3 id="52-验证k8s集群节点是否可用"><strong>5.2 验证K8S集群节点是否可用</strong><a class="headerlink" href="#52-验证k8s集群节点是否可用" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos="1 "></span></a>[root@k8s-master01 ~]# kubectl get nodes
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos="2 "></span></a>NAME           STATUS     ROLES           AGE   VERSION
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos="3 "></span></a>k8s-master01   NotReady   control-plane   30m   v1.28.2
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><a href="#__codelineno-30-4"><span class="linenos" data-linenos="4 "></span></a>k8s-worker01   NotReady   &lt;none&gt;          19m   v1.28.2
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><a href="#__codelineno-30-5"><span class="linenos" data-linenos="5 "></span></a>k8s-worker02   NotReady   &lt;none&gt;          18m   v1.28.2
</code></pre></div>
<h3 id="53-验证证书有效期"><strong>5.3 验证证书有效期</strong><a class="headerlink" href="#53-验证证书有效期" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos=" 1 "></span></a>[root@k8s-master01 ~]# openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text | grep &#39; Not &#39;
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><a href="#__codelineno-31-2"><span class="linenos" data-linenos=" 2 "></span></a>            Not Before: Nov 14 08:10:42 2023 GMT
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><a href="#__codelineno-31-3"><span class="linenos" data-linenos=" 3 "></span></a>            Not After : Oct 21 08:15:42 2123 GMT
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><a href="#__codelineno-31-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><a href="#__codelineno-31-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><a href="#__codelineno-31-6"><span class="linenos" data-linenos=" 6 "></span></a>[root@k8s-master01 ~]# kubeadm certs check-expiration
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><a href="#__codelineno-31-7"><span class="linenos" data-linenos=" 7 "></span></a>[check-expiration] Reading configuration from the cluster...
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><a href="#__codelineno-31-8"><span class="linenos" data-linenos=" 8 "></span></a>[check-expiration] FYI: You can look at this config file with &#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><a href="#__codelineno-31-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><a href="#__codelineno-31-10"><span class="linenos" data-linenos="10 "></span></a>CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><a href="#__codelineno-31-11"><span class="linenos" data-linenos="11 "></span></a>admin.conf                 Oct 21, 2123 08:15 UTC   99y             ca                      no      
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><a href="#__codelineno-31-12"><span class="linenos" data-linenos="12 "></span></a>apiserver                  Oct 21, 2123 08:15 UTC   99y             ca                      no      
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><a href="#__codelineno-31-13"><span class="linenos" data-linenos="13 "></span></a>apiserver-etcd-client      Oct 21, 2123 08:15 UTC   99y             etcd-ca                 no      
<a id="__codelineno-31-14" name="__codelineno-31-14"></a><a href="#__codelineno-31-14"><span class="linenos" data-linenos="14 "></span></a>apiserver-kubelet-client   Oct 21, 2123 08:15 UTC   99y             ca                      no      
<a id="__codelineno-31-15" name="__codelineno-31-15"></a><a href="#__codelineno-31-15"><span class="linenos" data-linenos="15 "></span></a>controller-manager.conf    Oct 21, 2123 08:15 UTC   99y             ca                      no      
<a id="__codelineno-31-16" name="__codelineno-31-16"></a><a href="#__codelineno-31-16"><span class="linenos" data-linenos="16 "></span></a>etcd-healthcheck-client    Oct 21, 2123 08:15 UTC   99y             etcd-ca                 no      
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><a href="#__codelineno-31-17"><span class="linenos" data-linenos="17 "></span></a>etcd-peer                  Oct 21, 2123 08:15 UTC   99y             etcd-ca                 no      
<a id="__codelineno-31-18" name="__codelineno-31-18"></a><a href="#__codelineno-31-18"><span class="linenos" data-linenos="18 "></span></a>etcd-server                Oct 21, 2123 08:15 UTC   99y             etcd-ca                 no      
<a id="__codelineno-31-19" name="__codelineno-31-19"></a><a href="#__codelineno-31-19"><span class="linenos" data-linenos="19 "></span></a>front-proxy-client         Oct 21, 2123 08:15 UTC   99y             front-proxy-ca          no      
<a id="__codelineno-31-20" name="__codelineno-31-20"></a><a href="#__codelineno-31-20"><span class="linenos" data-linenos="20 "></span></a>scheduler.conf             Oct 21, 2123 08:15 UTC   99y             ca                      no      
<a id="__codelineno-31-21" name="__codelineno-31-21"></a><a href="#__codelineno-31-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-31-22" name="__codelineno-31-22"></a><a href="#__codelineno-31-22"><span class="linenos" data-linenos="22 "></span></a>CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED
<a id="__codelineno-31-23" name="__codelineno-31-23"></a><a href="#__codelineno-31-23"><span class="linenos" data-linenos="23 "></span></a>ca                      Oct 21, 2123 08:15 UTC   99y             no      
<a id="__codelineno-31-24" name="__codelineno-31-24"></a><a href="#__codelineno-31-24"><span class="linenos" data-linenos="24 "></span></a>etcd-ca                 Oct 21, 2123 08:15 UTC   99y             no      
<a id="__codelineno-31-25" name="__codelineno-31-25"></a><a href="#__codelineno-31-25"><span class="linenos" data-linenos="25 "></span></a>front-proxy-ca          Oct 21, 2123 08:15 UTC   99y             no 
</code></pre></div>
<h2 id="六-网络插件calico部署"><strong>六 网络插件calico部署</strong><a class="headerlink" href="#六-网络插件calico部署" title="Permanent link">&para;</a></h2>
<p>calico访问链接：<a href="https://projectcalico.docs.tigera.io/about/about-calico">https://projectcalico.docs.tigera.io/about/about-calico</a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/564c3e6325621b5ea8799863e63483e0-image-20240424172859041-90e388.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172859041" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/564c3e6325621b5ea8799863e63483e0-image-20240424172859041-90e388.png" /></a></p>
<p><a class="glightbox" href="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/2bbd8d6f7888baac03f511879de3881e-image-20240424172903411-1a5bbc.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20240424172903411" src="https://raw.githubusercontent.com/joshzhong66/Pibced/main/blog-images/2024/04/24/2bbd8d6f7888baac03f511879de3881e-image-20240424172903411-1a5bbc.png" /></a></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1"># kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/tigera-operator.yaml</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><a href="#__codelineno-32-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><a href="#__codelineno-32-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="c1"># wget https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/custom-resources.yaml</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><a href="#__codelineno-32-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><a href="#__codelineno-32-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><a href="#__codelineno-32-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="c1"># vim custom-resources.yaml</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><a href="#__codelineno-32-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><a href="#__codelineno-32-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><a href="#__codelineno-32-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1"># cat custom-resources.yaml</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><a href="#__codelineno-32-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><a href="#__codelineno-32-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><a href="#__codelineno-32-12"><span class="linenos" data-linenos="12 "></span></a><span class="c1"># This section includes base Calico installation configuration.</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><a href="#__codelineno-32-13"><span class="linenos" data-linenos="13 "></span></a><span class="c1"># For more information, see: https://projectcalico.docs.tigera.io/master/reference/installation/api#operator.tigera.io/v1.Installation</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><a href="#__codelineno-32-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">apiVersion</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">tigera</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><a href="#__codelineno-32-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">kind</span><span class="p">:</span> <span class="n">Installation</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a><a href="#__codelineno-32-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">metadata</span><span class="p">:</span>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a><a href="#__codelineno-32-17"><span class="linenos" data-linenos="17 "></span></a>  <span class="n">name</span><span class="p">:</span> <span class="n">default</span>
<a id="__codelineno-32-18" name="__codelineno-32-18"></a><a href="#__codelineno-32-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">spec</span><span class="p">:</span>
<a id="__codelineno-32-19" name="__codelineno-32-19"></a><a href="#__codelineno-32-19"><span class="linenos" data-linenos="19 "></span></a>  <span class="c1"># Configures Calico networking.</span>
<a id="__codelineno-32-20" name="__codelineno-32-20"></a><a href="#__codelineno-32-20"><span class="linenos" data-linenos="20 "></span></a>  <span class="n">calicoNetwork</span><span class="p">:</span>
<a id="__codelineno-32-21" name="__codelineno-32-21"></a><a href="#__codelineno-32-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="c1"># Note: The ipPools section cannot be modified post-install.</span>
<a id="__codelineno-32-22" name="__codelineno-32-22"></a><a href="#__codelineno-32-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">ipPools</span><span class="p">:</span>
<a id="__codelineno-32-23" name="__codelineno-32-23"></a><a href="#__codelineno-32-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="o">-</span> <span class="n">blockSize</span><span class="p">:</span> <span class="mi">26</span>
<a id="__codelineno-32-24" name="__codelineno-32-24"></a><a href="#__codelineno-32-24"><span class="linenos" data-linenos="24 "></span></a>      <span class="n">cidr</span><span class="p">:</span> <span class="mf">10.244.0.0</span><span class="o">/</span><span class="mi">16</span> <span class="n">修改此行内容为初始化时定义的pod</span> <span class="n">network</span> <span class="n">cidr</span>
<a id="__codelineno-32-25" name="__codelineno-32-25"></a><a href="#__codelineno-32-25"><span class="linenos" data-linenos="25 "></span></a>      <span class="n">encapsulation</span><span class="p">:</span> <span class="n">VXLANCrossSubnet</span>
<a id="__codelineno-32-26" name="__codelineno-32-26"></a><a href="#__codelineno-32-26"><span class="linenos" data-linenos="26 "></span></a>      <span class="n">natOutgoing</span><span class="p">:</span> <span class="n">Enabled</span>
<a id="__codelineno-32-27" name="__codelineno-32-27"></a><a href="#__codelineno-32-27"><span class="linenos" data-linenos="27 "></span></a>      <span class="n">nodeSelector</span><span class="p">:</span> <span class="nb">all</span><span class="p">()</span>
<a id="__codelineno-32-28" name="__codelineno-32-28"></a><a href="#__codelineno-32-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-32-29" name="__codelineno-32-29"></a><a href="#__codelineno-32-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-32-30" name="__codelineno-32-30"></a><a href="#__codelineno-32-30"><span class="linenos" data-linenos="30 "></span></a><span class="o">---</span>
<a id="__codelineno-32-31" name="__codelineno-32-31"></a><a href="#__codelineno-32-31"><span class="linenos" data-linenos="31 "></span></a>
<a id="__codelineno-32-32" name="__codelineno-32-32"></a><a href="#__codelineno-32-32"><span class="linenos" data-linenos="32 "></span></a><span class="c1"># This section configures the Calico API server.</span>
<a id="__codelineno-32-33" name="__codelineno-32-33"></a><a href="#__codelineno-32-33"><span class="linenos" data-linenos="33 "></span></a><span class="c1"># For more information, see: https://projectcalico.docs.tigera.io/master/reference/installation/api#operator.tigera.io/v1.APIServer</span>
<a id="__codelineno-32-34" name="__codelineno-32-34"></a><a href="#__codelineno-32-34"><span class="linenos" data-linenos="34 "></span></a><span class="n">apiVersion</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">tigera</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
<a id="__codelineno-32-35" name="__codelineno-32-35"></a><a href="#__codelineno-32-35"><span class="linenos" data-linenos="35 "></span></a><span class="n">kind</span><span class="p">:</span> <span class="n">APIServer</span>
<a id="__codelineno-32-36" name="__codelineno-32-36"></a><a href="#__codelineno-32-36"><span class="linenos" data-linenos="36 "></span></a><span class="n">metadata</span><span class="p">:</span>
<a id="__codelineno-32-37" name="__codelineno-32-37"></a><a href="#__codelineno-32-37"><span class="linenos" data-linenos="37 "></span></a>  <span class="n">name</span><span class="p">:</span> <span class="n">default</span>
<a id="__codelineno-32-38" name="__codelineno-32-38"></a><a href="#__codelineno-32-38"><span class="linenos" data-linenos="38 "></span></a><span class="n">spec</span><span class="p">:</span> <span class="p">{}</span>
<a id="__codelineno-32-39" name="__codelineno-32-39"></a><a href="#__codelineno-32-39"><span class="linenos" data-linenos="39 "></span></a>
<a id="__codelineno-32-40" name="__codelineno-32-40"></a><a href="#__codelineno-32-40"><span class="linenos" data-linenos="40 "></span></a>
<a id="__codelineno-32-41" name="__codelineno-32-41"></a><a href="#__codelineno-32-41"><span class="linenos" data-linenos="41 "></span></a><span class="c1"># kubectl create -f custom-resources.yaml</span>
<a id="__codelineno-32-42" name="__codelineno-32-42"></a><a href="#__codelineno-32-42"><span class="linenos" data-linenos="42 "></span></a>
<a id="__codelineno-32-43" name="__codelineno-32-43"></a><a href="#__codelineno-32-43"><span class="linenos" data-linenos="43 "></span></a><span class="n">installation</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">tigera</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">default</span> <span class="n">created</span>
<a id="__codelineno-32-44" name="__codelineno-32-44"></a><a href="#__codelineno-32-44"><span class="linenos" data-linenos="44 "></span></a><span class="n">apiserver</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">tigera</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">default</span> <span class="n">created</span>
<a id="__codelineno-32-45" name="__codelineno-32-45"></a><a href="#__codelineno-32-45"><span class="linenos" data-linenos="45 "></span></a>
<a id="__codelineno-32-46" name="__codelineno-32-46"></a><a href="#__codelineno-32-46"><span class="linenos" data-linenos="46 "></span></a>
<a id="__codelineno-32-47" name="__codelineno-32-47"></a><a href="#__codelineno-32-47"><span class="linenos" data-linenos="47 "></span></a>
<a id="__codelineno-32-48" name="__codelineno-32-48"></a><a href="#__codelineno-32-48"><span class="linenos" data-linenos="48 "></span></a>
<a id="__codelineno-32-49" name="__codelineno-32-49"></a><a href="#__codelineno-32-49"><span class="linenos" data-linenos="49 "></span></a>
<a id="__codelineno-32-50" name="__codelineno-32-50"></a><a href="#__codelineno-32-50"><span class="linenos" data-linenos="50 "></span></a><span class="p">[</span><span class="n">root</span><span class="nd">@k8s</span><span class="o">-</span><span class="n">master01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># kubectl get pods -n calico-system</span>
<a id="__codelineno-32-51" name="__codelineno-32-51"></a><a href="#__codelineno-32-51"><span class="linenos" data-linenos="51 "></span></a><span class="n">NAME</span>                                       <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>       <span class="n">AGE</span>
<a id="__codelineno-32-52" name="__codelineno-32-52"></a><a href="#__codelineno-32-52"><span class="linenos" data-linenos="52 "></span></a><span class="n">calico</span><span class="o">-</span><span class="n">kube</span><span class="o">-</span><span class="n">controllers</span><span class="o">-</span><span class="mi">7</span><span class="n">dbdcfcfcb</span><span class="o">-</span><span class="n">gv74j</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>              <span class="mi">120</span><span class="n">m</span>
<a id="__codelineno-32-53" name="__codelineno-32-53"></a><a href="#__codelineno-32-53"><span class="linenos" data-linenos="53 "></span></a><span class="n">calico</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">7</span><span class="n">k2dq</span>                          <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">7</span> <span class="p">(</span><span class="mi">107</span><span class="n">m</span> <span class="n">ago</span><span class="p">)</span>   <span class="mi">120</span><span class="n">m</span>
<a id="__codelineno-32-54" name="__codelineno-32-54"></a><a href="#__codelineno-32-54"><span class="linenos" data-linenos="54 "></span></a><span class="n">calico</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">bf8kk</span>                          <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">7</span> <span class="p">(</span><span class="mi">108</span><span class="n">m</span> <span class="n">ago</span><span class="p">)</span>   <span class="mi">120</span><span class="n">m</span>
<a id="__codelineno-32-55" name="__codelineno-32-55"></a><a href="#__codelineno-32-55"><span class="linenos" data-linenos="55 "></span></a><span class="n">calico</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">xbh6b</span>                          <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">7</span> <span class="p">(</span><span class="mi">107</span><span class="n">m</span> <span class="n">ago</span><span class="p">)</span>   <span class="mi">120</span><span class="n">m</span>
<a id="__codelineno-32-56" name="__codelineno-32-56"></a><a href="#__codelineno-32-56"><span class="linenos" data-linenos="56 "></span></a><span class="n">calico</span><span class="o">-</span><span class="n">typha</span><span class="o">-</span><span class="mi">9477</span><span class="n">d4bb6</span><span class="o">-</span><span class="n">lcv9f</span>               <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>              <span class="mi">120</span><span class="n">m</span>
<a id="__codelineno-32-57" name="__codelineno-32-57"></a><a href="#__codelineno-32-57"><span class="linenos" data-linenos="57 "></span></a><span class="n">calico</span><span class="o">-</span><span class="n">typha</span><span class="o">-</span><span class="mi">9477</span><span class="n">d4bb6</span><span class="o">-</span><span class="n">wf4hn</span>               <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>              <span class="mi">120</span><span class="n">m</span>
<a id="__codelineno-32-58" name="__codelineno-32-58"></a><a href="#__codelineno-32-58"><span class="linenos" data-linenos="58 "></span></a><span class="n">csi</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">driver</span><span class="o">-</span><span class="mi">44</span><span class="n">vt4</span>                      <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>     <span class="n">Running</span>   <span class="mi">0</span>              <span class="mi">120</span><span class="n">m</span>
<a id="__codelineno-32-59" name="__codelineno-32-59"></a><a href="#__codelineno-32-59"><span class="linenos" data-linenos="59 "></span></a><span class="n">csi</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">driver</span><span class="o">-</span><span class="mi">6867</span><span class="n">q</span>                      <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>     <span class="n">Running</span>   <span class="mi">0</span>              <span class="mi">120</span><span class="n">m</span>
<a id="__codelineno-32-60" name="__codelineno-32-60"></a><a href="#__codelineno-32-60"><span class="linenos" data-linenos="60 "></span></a><span class="n">csi</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">driver</span><span class="o">-</span><span class="n">x96sz</span>                      <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>     <span class="n">Running</span>   <span class="mi">0</span>              <span class="mi">120</span><span class="n">m</span>
</code></pre></div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-11-21</span>
  </span>

    
    
    
    
  </aside>


  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../k8s%E5%88%9B%E5%BB%BA%E5%AE%89%E8%A3%85dashboard/" class="md-footer__link md-footer__link--prev" aria-label="上一页: K8s创建安装dashboard">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                K8s创建安装dashboard
              </div>
            </div>
          </a>
        
        
          
          <a href="../../git/Git/Git%20Extensions%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/" class="md-footer__link md-footer__link--next" aria-label="下一页: Git Extensions使用文档">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Git Extensions使用文档
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Copyright and theme information -->
<div class="md-copyright">
  
    <div class="md-copyright__highlight">
      版权所有 © 2023-2024 | <a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">粤ICP备2024253391号</a>
    </div>
  
  
    <script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/3JIbgFniDcGIaNP7/quote.js?theme=#FFFFFF,#808080,#808080,#B3B3B3,#FFFFFF,#1690FF,12&f=12&display=0,0,1,1,1,1,1,1"></script>
    <!--Made with
    <a
      href="https://squidfunk.github.io/mkdocs-material/"
      target="_blank" rel="noopener"
    >
      Material for MkDocs
    </a> | <a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">粤ICP备16023717号</a-->
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.google.com/" target="_blank" rel="noopener" title="Google" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linux.org/" target="_blank" rel="noopener" title="Linux" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M220.8 123.3c1 .5 1.8 1.7 3 1.7 1.1 0 2.8-.4 2.9-1.5.2-1.4-1.9-2.3-3.2-2.9-1.7-.7-3.9-1-5.5-.1-.4.2-.8.7-.6 1.1.3 1.3 2.3 1.1 3.4 1.7zm-21.9 1.7c1.2 0 2-1.2 3-1.7 1.1-.6 3.1-.4 3.5-1.6.2-.4-.2-.9-.6-1.1-1.6-.9-3.8-.6-5.5.1-1.3.6-3.4 1.5-3.2 2.9.1 1 1.8 1.5 2.8 1.4zM420 403.8c-3.6-4-5.3-11.6-7.2-19.7-1.8-8.1-3.9-16.8-10.5-22.4-1.3-1.1-2.6-2.1-4-2.9-1.3-.8-2.7-1.5-4.1-2 9.2-27.3 5.6-54.5-3.7-79.1-11.4-30.1-31.3-56.4-46.5-74.4-17.1-21.5-33.7-41.9-33.4-72C311.1 85.4 315.7.1 234.8 0 132.4-.2 158 103.4 156.9 135.2c-1.7 23.4-6.4 41.8-22.5 64.7-18.9 22.5-45.5 58.8-58.1 96.7-6 17.9-8.8 36.1-6.2 53.3-6.5 5.8-11.4 14.7-16.6 20.2-4.2 4.3-10.3 5.9-17 8.3s-14 6-18.5 14.5c-2.1 3.9-2.8 8.1-2.8 12.4 0 3.9.6 7.9 1.2 11.8 1.2 8.1 2.5 15.7.8 20.8-5.2 14.4-5.9 24.4-2.2 31.7 3.8 7.3 11.4 10.5 20.1 12.3 17.3 3.6 40.8 2.7 59.3 12.5 19.8 10.4 39.9 14.1 55.9 10.4 11.6-2.6 21.1-9.6 25.9-20.2 12.5-.1 26.3-5.4 48.3-6.6 14.9-1.2 33.6 5.3 55.1 4.1.6 2.3 1.4 4.6 2.5 6.7v.1c8.3 16.7 23.8 24.3 40.3 23 16.6-1.3 34.1-11 48.3-27.9 13.6-16.4 36-23.2 50.9-32.2 7.4-4.5 13.4-10.1 13.9-18.3.4-8.2-4.4-17.3-15.5-29.7zM223.7 87.3c9.8-22.2 34.2-21.8 44-.4 6.5 14.2 3.6 30.9-4.3 40.4-1.6-.8-5.9-2.6-12.6-4.9 1.1-1.2 3.1-2.7 3.9-4.6 4.8-11.8-.2-27-9.1-27.3-7.3-.5-13.9 10.8-11.8 23-4.1-2-9.4-3.5-13-4.4-1-6.9-.3-14.6 2.9-21.8zM183 75.8c10.1 0 20.8 14.2 19.1 33.5-3.5 1-7.1 2.5-10.2 4.6 1.2-8.9-3.3-20.1-9.6-19.6-8.4.7-9.8 21.2-1.8 28.1 1 .8 1.9-.2-5.9 5.5-15.6-14.6-10.5-52.1 8.4-52.1zm-13.6 60.7c6.2-4.6 13.6-10 14.1-10.5 4.7-4.4 13.5-14.2 27.9-14.2 7.1 0 15.6 2.3 25.9 8.9 6.3 4.1 11.3 4.4 22.6 9.3 8.4 3.5 13.7 9.7 10.5 18.2-2.6 7.1-11 14.4-22.7 18.1-11.1 3.6-19.8 16-38.2 14.9-3.9-.2-7-1-9.6-2.1-8-3.5-12.2-10.4-20-15-8.6-4.8-13.2-10.4-14.7-15.3-1.4-4.9 0-9 4.2-12.3zm3.3 334c-2.7 35.1-43.9 34.4-75.3 18-29.9-15.8-68.6-6.5-76.5-21.9-2.4-4.7-2.4-12.7 2.6-26.4v-.2c2.4-7.6.6-16-.6-23.9-1.2-7.8-1.8-15 .9-20 3.5-6.7 8.5-9.1 14.8-11.3 10.3-3.7 11.8-3.4 19.6-9.9 5.5-5.7 9.5-12.9 14.3-18 5.1-5.5 10-8.1 17.7-6.9 8.1 1.2 15.1 6.8 21.9 16l19.6 35.6c9.5 19.9 43.1 48.4 41 68.9zm-1.4-25.9c-4.1-6.6-9.6-13.6-14.4-19.6 7.1 0 14.2-2.2 16.7-8.9 2.3-6.2 0-14.9-7.4-24.9-13.5-18.2-38.3-32.5-38.3-32.5-13.5-8.4-21.1-18.7-24.6-29.9s-3-23.3-.3-35.2c5.2-22.9 18.6-45.2 27.2-59.2 2.3-1.7.8 3.2-8.7 20.8-8.5 16.1-24.4 53.3-2.6 82.4.6-20.7 5.5-41.8 13.8-61.5 12-27.4 37.3-74.9 39.3-112.7 1.1.8 4.6 3.2 6.2 4.1 4.6 2.7 8.1 6.7 12.6 10.3 12.4 10 28.5 9.2 42.4 1.2 6.2-3.5 11.2-7.5 15.9-9 9.9-3.1 17.8-8.6 22.3-15 7.7 30.4 25.7 74.3 37.2 95.7 6.1 11.4 18.3 35.5 23.6 64.6 3.3-.1 7 .4 10.9 1.4 13.8-35.7-11.7-74.2-23.3-84.9-4.7-4.6-4.9-6.6-2.6-6.5 12.6 11.2 29.2 33.7 35.2 59 2.8 11.6 3.3 23.7.4 35.7 16.4 6.8 35.9 17.9 30.7 34.8-2.2-.1-3.2 0-4.2 0 3.2-10.1-3.9-17.6-22.8-26.1-19.6-8.6-36-8.6-38.3 12.5-12.1 4.2-18.3 14.7-21.4 27.3-2.8 11.2-3.6 24.7-4.4 39.9-.5 7.7-3.6 18-6.8 29-32.1 22.9-76.7 32.9-114.3 7.2zm257.4-11.5c-.9 16.8-41.2 19.9-63.2 46.5-13.2 15.7-29.4 24.4-43.6 25.5s-26.5-4.8-33.7-19.3c-4.7-11.1-2.4-23.1 1.1-36.3 3.7-14.2 9.2-28.8 9.9-40.6.8-15.2 1.7-28.5 4.2-38.7 2.6-10.3 6.6-17.2 13.7-21.1.3-.2.7-.3 1-.5.8 13.2 7.3 26.6 18.8 29.5 12.6 3.3 30.7-7.5 38.4-16.3 9-.3 15.7-.9 22.6 5.1 9.9 8.5 7.1 30.3 17.1 41.6 10.6 11.6 14 19.5 13.7 24.6zM173.3 148.7c2 1.9 4.7 4.5 8 7.1 6.6 5.2 15.8 10.6 27.3 10.6 11.6 0 22.5-5.9 31.8-10.8 4.9-2.6 10.9-7 14.8-10.4s5.9-6.3 3.1-6.6-2.6 2.6-6 5.1c-4.4 3.2-9.7 7.4-13.9 9.8-7.4 4.2-19.5 10.2-29.9 10.2s-18.7-4.8-24.9-9.7c-3.1-2.5-5.7-5-7.7-6.9-1.5-1.4-1.9-4.6-4.3-4.9-1.4-.1-1.8 3.7 1.7 6.5z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.tracking", "navigation.indexes", "navigation.sections", "navigation.expand", "navigation.prune", "navigation.path", "toc.follow", "navigation.top", "search.suggest", "search.highlight", "search.share", "navigation.footer", "content.code.copy", "content.action.view"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.af256bd8.min.js"></script>
      
        <script src="../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.bootcss.com/mathjax/3.0.5/es5/tex-mml-chtml.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>